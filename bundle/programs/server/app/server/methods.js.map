{"version":3,"sources":["meteor://ðŸ’»app/server/methods.js"],"names":[],"mappings":"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","file":"/server/methods.js","sourcesContent":["Meteor.startup(function() {\n\n\n\t// ###  Mail configuration  ###\n\tprocess.env.MAIL_URL = 'smtp://'+Meteor.settings.mailAddress+':'+Meteor.settings.mailPassword+'@'+Meteor.settings.mailServer;          \n\tAccounts.emailTemplates.from = \"beekee.ch <vincent.widmer@beekee.ch>\";\n\n\t// Reset Password mail configuration\n\tAccounts.emailTemplates.resetPassword.text = function (user, url) {\n \t\treturn \"Hi, \\n\\n You recently requested to reset your password for your Beekee account.\\n\\n Click the link below to reset it. : \\n\"\n\t\t+ url\n\t\t+ \"\\n\\n If you did not requested a password reset, please ignore this email.\"\n\t\t+ \"\\n\\n Thanks,\"\n\t\t+ \"\\n\\n Beekee Team\";\n\t};\n\tAccounts.emailTemplates.resetPassword.subject = function () {\n \t\treturn \"Reset your Beekee password\";\n\t};\n\n\tAccounts.urls.resetPassword = function(token) {\n\t\treturn 'http://web.beekee.ch/reset-password/' + token;\n\t};\n});\n\n\nexec = Npm.require('child_process').exec; // No idea what is this ?\ncmd = Meteor.wrapAsync(exec);\n\nMeteor.methods({\n\tsendEmail: function (to, from, subject, text) {\n\t\tcheck([to, from, subject, text], [String]);\n\n\t\t// Let other method calls from the same client start running, without waiting for the email sending to complete.\n\t\tthis.unblock();\n\n\t\tEmail.send({\n\t\t\tto: to,\n\t\t\tfrom: from,\n\t\t\tsubject: subject,\n\t\t\ttext: text\n\t\t});\n\t},\n\t'adminSetNewPassword': function(adminId, userId, newPassword) { // Admin can forcibly change the password for a user\n\t\tif (Roles.userIsInRole(adminId, 'admin')) {\n\t\t\tconsole.log(Accounts.setPassword(userId, newPassword));\n\t\t\t\n\t\t}\n\t},\n\t'createAccount': function(email, password, profile) {\n\t\tAccounts.createUser({email:email,password:password,profile:profile}); // Callback is not supported on server-side\n\t},\n\t'deleteUser': function(userId) {\n\t\tMeteor.users.remove(userId, function (error, result) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log(\"Error when deleting user : \"+error.message);\n\t\t\t}\n\t\t});\n\t},\n\t'getIP': function() { // Get IP of box\n\t\t\tvar res;\n\t\t\tres = cmd(\"ifconfig eth0 2>/dev/null|awk '/inet addr:/ {print $2}'|sed 's/addr://'\");\n\t\t\treturn res;\n\t},\n\t'getRaspbianVersion': function() {\n\t\tvar res;\n\t\tres = cmd(\"cat /etc/debian_version\");\n\t\treturn res;\n\t},\n\t'getUsedSpace': function() {\n\t\tvar res;\n\t\tres = cmd(\"df / -h | awk '{print ($3)}' | tail -1\") + \"/ \" + cmd(\"df / -h | awk '{print ($2)}' | tail -1\") + \" (\"+cmd(\"df / | awk '{print ($5)}' | tail -1\")+\"used)\";\n\t\treturn res;\n\t},\n\t'getBeekeeVersion': function() {\n\t\tjson = JSON.parse(Assets.getText(\"version.json\"));\n\t\t//json = JSON.parse(Assets.getText(\"version.json\"));\n\t\treturn json.version;\n\t},\n\t'getBoxSerial': function() {\n\t\treturn Meteor.settings.serial;\n\t},\n\t'rebootBox': function() { // Shutdown the Raspberry Pi\n\t\t\tvar res;\n\t\t\tres = cmd(\"sudo reboot\");\n\t\t\treturn res;\n\t},\n\t'shutdownBox': function() { // Shutdown the Raspberry Pi\n\t\t\tvar res;\n\t\t\tres = cmd(\"sudo shutdown\");\n\t\t\treturn res;\n\t}\n});"]}