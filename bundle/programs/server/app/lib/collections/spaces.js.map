{"version":3,"sources":["meteor://ðŸ’»app/lib/collections/spaces.js"],"names":[],"mappings":"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","file":"/lib/collections/spaces.js","sourcesContent":["Spaces = new Mongo.Collection('spaces');\n\nSpaces.allow({\n\n\t//update: function(userId, space) { return true},\n\t//remove: function(userId, space) { return true},\n\n\tinsert: function(userId, space) { return true; },\n\tupdate: function(userId, space) { return true; },\n\tremove: function(userId, space) { return true; }\n\n\t// insert: function(userId, space) { return ownsDocument(userId, space) || isAdmin(userId); },\n\n\t// update: function(userId, space) { return ownsDocument(userId, space) || isAdmin(userId); },\n\n\t// remove: function(userId, space) { return ownsDocument(userId, space) || isAdmin(userId); }\n});\n\n\nif(Meteor.isServer) {\n\n\tSpaces.before.update(function (userId, doc, fieldNames, modifier, options) {\n\n\t\tmodifier.$set = modifier.$set || {};\n\t\tmodifier.$set.modified = Date.now();\n\n\t\t// change modified date\n\t\tdoc.version =  doc.version++;\n\t\tdoc.modified = Date.now();\n\t});\n\n\tSpaces.before.insert(function (userId, doc) {\n\t\t// change modified date\n\t\tdoc.submitted =  Date.now();\n\t});\n\n\n\tSpaces.before.remove(function (userId, doc) {\n\n\t\tvar spaceId = doc._id;\n\t\tPosts.remove({spaceId:spaceId});\n\t});\n\n\n\tMeteor.methods({\n\n\t\tgetSpaceId: function(spaceCode) {\n\t\t\tif (Spaces.findOne({spaceCode:spaceCode}))\n\t\t\t\treturn Spaces.findOne({spaceCode:spaceCode})._id;\n\t\t\telse\n\t\t\t\treturn null;\n\t\t},\n\t\tupdateCode: function(oldCode, newCode) {\n\t\t\tvar codeId = Codes.findOne({code: oldCode})._id;\n\t\t\tCodes.update(codeId,{code:newCode}, function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log(\"Error when changing code : \"+error.message);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log(\"Code has been changed.\");\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tdeleteSpace: function(spaceId) {\n\t\t\tSpaces.remove(spaceId);\n\t\t\t//Posts.remove({spaceId:spaceId},{multi:true});\n\t\t},\n\t\tdeleteSpaces: function(userId) {\n\n\t\t\tSpaces.remove({userId:userId});\n\n\t\t},\n\t\tspaceInsert: function(spaceAttributes) {\n\n\t\t\tcheck(spaceAttributes, {\n\t\t\t\t\ttitle: String,\n\t\t\t\t\t_id : String,\n\t\t\t});\n\n\t\t\tvar nbOfCodes = Codes.find().count();\n\t\t\tvar prefix = Meteor.settings.public.prefix;\n\t\t\tvar codeLength = 4;\n\n\t\t\tif (nbOfCodes <= 1000)\n\t\t\t\tcodeLength = 2;\n\t\t\telse if (nbOfCodes > 1000 && nbOfCodes <= 100000)\n\t\t\t\tcodeLength = 3;\n\t\t\telse if (nbOfCodes > 100000 && nbOfCodes <= 10000000)\n\t\t\t\tcodeLength = 4;\n\n\t\t\tvar code = prefix + makeCode(codeLength);\n\t\t\twhile (typeof Codes.findOne({code: code}) != 'undefined')\n\t\t\t\tcode = prefix + makeCode(codeLength);\n\n\t\t\tCodes.insert({code:code, userId:Meteor.userId()});\n\n\t\t\tvar user = Meteor.user();\n\t\t\tvar space = _.extend(spaceAttributes, {\n\t\t\t\t//userId: user._id,\n\t\t\t\tspaceCode: code,\n\t\t\t\tsubmitted: new Date(),\n\t\t\t\tvisible: true,\n\t\t\t\tcodePanel: true,\n\t\t\t\tcreateUserAllowed:true,\n\t\t\t\tliveFeed:true,\n\t\t\t\tlessons:false,\n\t\t\t\tresources:true,\n\t\t\t\tliveFeedComments:true,\n\t\t\t\tpermissions:{public:false, liveFeedAddPost:true, liveFeedAddCategory:false}\n\t\t\t});\n\n\t\t\tvar spaceId = Spaces.insert(space);\n\n\t\t\tMeteor.call('authorInsert', 'InvitÃ©', spaceId );\n\n\t\t\t// Insert welcome post\n\t\t\tPosts.insert({spaceId:spaceId, type:\"home\", order:0, submitted: Date.now(),title: \"Welcome!\", body:\"<p><em>Spaces</em> in Beekee are ideal for real-time interactions using the <strong>Live Feed</strong>, hosting training content in <strong>Lessons</strong> (if enabled) and sharing files with your learners in <strong>Resources</strong>.</p>\\n<p>This is the Home page of your space. Right now it is empty but feel free to edit (or delete) this post to start.</p>\\n<p>----------------------</p>\\n<p>Les <em>Espaces</em>&nbsp;dans Beekee sont le lieu id&eacute;al pour&nbsp;interagir en temps r&eacute;el en utilisant&nbsp;<strong>Direct</strong>,&nbsp;proposer du contenu d'apprentissage dans&nbsp;<strong>Le&ccedil;ons</strong> (si activ&eacute;) et partager des fichiers avec vos apprenants dans&nbsp;<strong>Ressources</strong>.</p>\\n<p>Ceci est la page d'accueil de votre espace. Pour l'instant, elle est vide, mais sentez-vous libre de modifier (ou de supprimer) ce post pour d&eacute;buter.</p>\"});\n\n\t\t\treturn { _id: spaceId };\n\t\t}\n\t});\n}\n\n\nfunction makeCode(length)\n{\n\tvar text = \"\";\n\tvar possible = \"ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789\";\n\n\tfor( var i=0; i < length; i++ )\n\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\t\n\treturn text;\n}"]}